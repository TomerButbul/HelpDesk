<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <!-- Include Socket.io client library -->
    <script src="https://cdn.socket.io/4.3.1/socket.io.min.js"></script>
    <style>
        /* CSS styles go here */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-size: 1rem;
            font-family: Arial, Helvetica, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
        }

        main {
            height: 100vh;
            padding: 1rem;
            display: flex;
            flex-flow: column;
            align-items: center;
        }

        form {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-flow: row nowrap;
            gap: .25rem;
        }

        input {
            flex-grow: 1;
            max-width: calc(80% - .25rem);
            border-radius: 10px;
            padding: .5rem;
        }

        button {
            width: 20%;
            border-radius: 10px;
            padding: .5rem;
            background-color: #333;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        .chat-display {
            background-color: #333;
            list-style-type: none;
            width: 100%;
            max-width: 600px;
            border-radius: 10px;
            margin-top: 1rem;
            padding: 0;
            overflow-y: auto;
        }

        .post {
            background-color: #eee;
            border-radius: 10px;
            margin: .5rem;
            padding: .5rem;
            overflow: hidden;
        }

        .post--left {
            width: 60%;
            align-self: flex-start;
        }

        .post--right {
            width: 60%;
            align-self: flex-end;
        }

        .post .post__header {
            color: #fff;
            padding: .25rem .5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: .5rem;
        }

        .post--left .post__header {
            background-color: blue;
        }

        .post--right .post__header {
            background-color: purple;
        }

        .post__header .post__header--name {
            font-weight: bold;
        }

        .post__header .post__header--time {
            font-size: .8rem;
        }

        .post__text {
            margin-top: 5px;
            color: #333;
            padding: .25rem .5rem;
        }

        .user-list,
        .room-list,
        .activity {
            width: 100%;
            min-height: 2.65rem;
            max-width: 600px;
            padding: .75rem .25rem;
        }

        .activity {
            font-style: italic;
        }
    </style>

    <!-- Include client-side JavaScript file -->
    <script defer src="app.js"></script>
    
    
</head>
<body>
    <main>
        <!-- Add id to the form for joining the chat room -->
        <form id="joinForm" class="form-join">
            <input type="text" id="name" maxlength="16" placeholder="Your name" size="5" required>
            <input type="text" id="room" maxlength="16" placeholder="Ticket ID" size="5" required>
            <button id="join" type="submit">Join</button>
        </form>
        <ul class="chat-display" style="display: none;"></ul>
        <p class="user-list" style="display: none;"></p>
        <p class="room-list" style="display: none;"></p>
        <p class="activity" style="display: none;"></p>
        <!-- Add id to the form for sending messages -->
        <form id="messageForm" class="form-msg" style="display: none;">
            <input type="text" id="message" placeholder="Your message" required>
            <button type="submit">Send</button>
        </form>
    </main>
<!-- Inline script to initialize the Socket.io connection and handle events -->
    <script>
        const socket = io('https://livechattomer.onrender.com'); // Replace with your server URL
        // Function to join the chat room
        document.getElementById('joinForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const name = document.getElementById('name').value;
    const room = document.getElementById('room').value;
    socket.emit('enterRoom', { name, room });
    // Hide the join button
    document.getElementById('join').style.display = 'none';
    // Hide the ticket ID box
    document.getElementById('room').style.display = 'none';
    // Hide the name input field
    document.getElementById('name').style.display = 'none';
    // Show the message input field and send button
    document.getElementById('messageForm').style.display = 'block';
    document.querySelector('.chat-display').style.display = 'block';
    document.querySelector('.user-list').style.display = 'block';
    document.querySelector('.room-list').style.display = 'block';
    document.querySelector('.activity').style.display = 'block';
});

         // Event listener to handle room full event
         socket.on('roomFull', function () {
             <!-- Add this section inside the <script> tag -->
        // Event listener to handle room full event
        socket.on('roomFull', function () {
        alert('Sorry, the room is full. Please try another room.'); // Display an alert message
        window.location.reload(); // Reload the page to allow joining another room
        });
        
         });

// Function to handle leaving the chat room
function leaveChatRoom(socketId) {
    // Emit 'leaveRoom' event to the server
    socket.emit('leaveRoom', socketId);
}
        // Function to send a message
        document.getElementById('messageForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const message = document.getElementById('message').value;
            const name = document.getElementById('name').value;
            socket.emit('message', { name, text: message });
            document.getElementById('message').value = ''; // Clear the input field
        });

        // Event listener to handle incoming messages
         socket.on('message', function (data) {
 const { name, text, time } = data;
            const message = `<li>${name} (${time}): ${text}</li>`;
            document.querySelector('.chat-display').innerHTML += message;
        });

        // Event listener to update the user list
        socket.on('userList', function (data) {
            const users = data.users;
            let userList = '<em>Connected:</em><br>';
            users.forEach(function (user) {
                userList += `${user.name}<br>`;
            });
            document.querySelector('.user-list').innerHTML = userList;
        });
        // Event listener to update the room list
        socket.on('roomList', function (data) {
            const rooms = data.rooms;
            let roomList = '<em>Ticket ID:</em><br>';
            rooms.forEach(function (room) {
                roomList += `${room}<br>`;
            });
            document.querySelector('.room-list').innerHTML = roomList;
        });
        // Event listener to handle typing activity
        document.getElementById('message').addEventListener('keypress', function () {
            socket.emit('activity', document.getElementById('name').value);
        });
        // Event listener to display typing activity
        socket.on('activity', function (name) {
            document.querySelector('.activity').textContent = `${name} is typing...`;
        });
    </script>
</body>
</html>
